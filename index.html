<!DOCTYPE html>
<html>
<head>
    <script src="js/formulae.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

</head>
<body>

<div class="container">
    <h1>Cochran - Armitage trend test Calculator</h1>
    <!-- <form id="frm-test" onsubmit="Calculate()"> -->
    <table id="testTable table">
        <thead>
            <tr>
                <th></th>
                <th>AA</th>
                <th>Aa</th>
                <th>aa</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>Cases</th>
                <td><input type="number" id="case_AA"></td>
                <td><input type="number" id="case_Aa"></td>
                <td><input type="number" id="case_aa"></td>
                <td><input id="total_case" disabled></td>
            </tr>
            <tr>
                <th>Controls</th>
                <td><input type="number" id="control_AA"></td>
                <td><input type="number" id="control_Aa"></td>
                <td><input type="number" id="control_aa"></td>
                <td><input id="total_control" disabled></td>
            </tr>
            <tr>
                <th>Total</th>
                <td><input id="total_AA" disabled></td>
                <td><input id="total_Aa" disabled></td>
                <td><input id="total_aa" disabled></td>
                <td><input id="total" disabled></td>
            </tr>
        </tbody>
    </table>

    <br><br>
    <button type="button" class="btn btn-success" onclick="Calculate()">Calculate</button>

<br><br>

<div id="result"></div>
<div id="result_chi"></div>
<div id="info"></div>


</div>
<!-- <button type="input" form="frm-test" onclick="Calculate" value="Submit">Calculate</button>
</form> -->

<script>
    function Calculate() {
        var cases_AA = parseFloat(document.getElementById("case_AA").value);
        var cases_Aa = parseFloat(document.getElementById("case_Aa").value);
        var cases_aa = parseFloat(document.getElementById("case_aa").value);
        var controls_AA = parseFloat(document.getElementById("control_AA").value);
        var controls_Aa = parseFloat(document.getElementById("control_Aa").value);
        var controls_aa = parseFloat(document.getElementById("control_aa").value);

        var total_AA = cases_AA + controls_AA;
        var total_Aa = cases_Aa + controls_Aa;
        var total_aa = cases_aa + controls_aa;
        var total_cases = cases_AA + cases_Aa + cases_aa;
        var total_controls = controls_AA + controls_Aa + controls_aa;
        var total = total_cases + total_controls;

        document.getElementById("total_case").value = total_cases;
        document.getElementById("total_control").value = total_controls;
        document.getElementById("total_AA").value = total_AA;
        document.getElementById("total_Aa").value = total_Aa;
        document.getElementById("total_aa").value = total_aa;
        document.getElementById("total").value = total;

        var p_cases = (2 * cases_AA + cases_Aa) / (2 * total_cases);
        var p_controls = (2 * controls_AA + controls_Aa) / (2 * total_controls);
        var p_hat = (2 * total_AA + total_Aa) / (2 * total);
        var Z = 2 * Math.sqrt(total_cases * total_controls) * (p_cases - p_controls) / Math.sqrt(4 * total_AA + total_Aa - 4 * total * p_hat * p_hat);
        var Z_Squared = Math.pow(Z, 2);

	
    var para = document.getElementById("result"); 
    para.innerText = "Z squared: " + Math.round(Z_Squared*10000)/10000;
    var result_chi = document.getElementById("result_chi");
    result_chi.innerText = "P-value: " +  Math.round(compute(Z_Squared, 1)*10000)/10000;
    var info = document.getElementById("info");
    info.innerHTML = "P-value calculated based on the &Chi;<sup>2</sup> distribution with 1 degree of freedom";

    }


</script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
</html>
